---
name: pr-submitter
description: Create pull requests for migrated repositories using GitHub CLI with standardized templates and migration summaries. Use after migration and validation are complete.
allowed-tools: Bash, Read, Glob, Grep
---

# PR Submitter Skill

Create standardized pull requests for Spring Boot migration changes using GitHub CLI.

## Prerequisites

- GitHub CLI (`gh`) must be installed and authenticated
- Repository must have changes committed to a feature branch
- Branch must be pushed to remote origin
- **Labels must exist** before PR creation (use `label-manager` skill to pre-create)

## Create Pull Request

### Basic PR Creation

```bash
cd /path/to/repo

gh pr create \
  --title "chore: Migrate to Spring Boot 4.x" \
  --body "$(cat <<'EOF'
## Spring Boot 4.x Migration

This PR migrates the project to Spring Boot 4.x with all required dependency and code updates.

### Changes Applied

#### Build Configuration
- [ ] Updated Spring Boot parent to 4.0.0
- [ ] Updated Spring Cloud BOM to 2025.1.0
- [ ] Added Jackson BOM 3.0.2

#### Dependency Updates
- [ ] Migrated Jackson groupId: `com.fasterxml.jackson` → `tools.jackson`
- [ ] Updated Spring Security dependencies

#### Code Changes
- [ ] Updated Jackson imports (preserved `annotation.*`)
- [ ] Changed `JsonProcessingException` → `JacksonException`
- [ ] Converted `VaadinWebSecurity` → `VaadinSecurityConfigurer` (if applicable)
- [ ] Updated `AntPathRequestMatcher` → `PathPatternRequestMatcher` (if applicable)

### Validation Results

- Build: **PASSED**
- Tests: **PASSED**
- Deprecation warnings: See details below

### Testing Instructions

1. Check out this branch
2. Run `./mvnw clean verify` or `./gradlew clean build`
3. Verify application starts correctly
4. Run integration tests if available

### Generated By

Spring Modernization Marketplace v1.0
EOF
)"
```

### PR with Labels and Reviewers

```bash
gh pr create \
  --title "chore: Migrate to Spring Boot 4.x" \
  --body "$PR_BODY" \
  --label "dependencies,spring-boot-4" \
  --reviewer "@org/platform-team" \
  --assignee "@me"
```

### PR Against Specific Base Branch

```bash
gh pr create \
  --title "chore: Migrate to Spring Boot 4.x" \
  --body "$PR_BODY" \
  --base main \
  --head feature/spring-boot-4-migration
```

### Fork-Based PR Creation

When you lack push access to a repository (READ-only permission), create PRs from a fork:

```bash
# Variables
UPSTREAM_REPO="owner/repo"           # Original repo (e.g., fastnsilver/grivet)
CURRENT_USER=$(gh api user --jq ".login")  # Your GitHub username
BRANCH_NAME="feature/spring-boot-4-migration"

# Create PR from fork to upstream
gh pr create \
  --repo "$UPSTREAM_REPO" \
  --head "$CURRENT_USER:$BRANCH_NAME" \
  --title "chore: Migrate to Spring Boot 4.x" \
  --body "$PR_BODY"
```

**Key differences for fork-based PRs:**

| Option      | Direct Push              | Fork-Based                     |
| ----------- | ------------------------ | ------------------------------ |
| `--repo`    | Not needed (uses origin) | Required: target upstream repo |
| `--head`    | Branch name only         | `username:branch` format       |
| Push target | `origin`                 | `fork` remote                  |

### Complete Fork-Based PR Workflow

```bash
UPSTREAM_REPO="fastnsilver/grivet"
BRANCH_NAME="feature/spring-boot-4-migration"
CURRENT_USER=$(gh api user --jq ".login")

# 1. Ensure fork exists
gh repo fork "$UPSTREAM_REPO" --clone=false 2>/dev/null || true

# 2. Add fork remote (if not already added)
git remote add fork "https://github.com/$CURRENT_USER/$(basename $UPSTREAM_REPO).git" 2>/dev/null || true

# 3. Push to fork
git push -u fork "$BRANCH_NAME"

# 4. Create PR from fork to upstream
gh pr create \
  --repo "$UPSTREAM_REPO" \
  --head "$CURRENT_USER:$BRANCH_NAME" \
  --title "chore: Migrate $(basename $UPSTREAM_REPO) to Spring Boot 4.x" \
  --body "$PR_BODY" \
  --label "spring-boot-4,automated"
```

### Automatic Fork Detection

Detect if fork-based workflow is needed before creating PR:

```bash
REPO="owner/repo"

# Check permission level
PERMISSION=$(gh repo view "$REPO" --json viewerPermission --jq ".viewerPermission")

case "$PERMISSION" in
  ADMIN|MAINTAIN|WRITE)
    echo "Direct PR creation available"
    gh pr create --title "..." --body "$PR_BODY"
    ;;
  *)
    echo "Fork-based PR required (permission: $PERMISSION)"
    CURRENT_USER=$(gh api user --jq ".login")
    gh pr create \
      --repo "$REPO" \
      --head "$CURRENT_USER:$BRANCH_NAME" \
      --title "..." \
      --body "$PR_BODY"
    ;;
esac
```

## PR Templates

### Standard Migration PR

```markdown
## Spring Boot 4.x Migration

This PR migrates the project to Spring Boot 4.x with all required dependency and code updates.

### Changes Applied

#### Build Configuration

- Updated Spring Boot parent to 4.0.0
- Updated Spring Cloud BOM to 2025.1.0
- Added Jackson BOM 3.0.2

#### Code Changes

- Updated Jackson imports (core/databind to tools.jackson)
- Preserved Jackson annotation imports (com.fasterxml.jackson.annotation)
- Updated exception handling (JacksonException)

### Validation

| Check             | Status                    |
| ----------------- | ------------------------- |
| Compilation       | :white_check_mark: Passed |
| Unit Tests        | :white_check_mark: Passed |
| Integration Tests | :white_check_mark: Passed |

### Generated By

Spring Modernization Marketplace v1.0
```

### Migration with Issues Found

```markdown
## Spring Boot 4.x Migration

### Changes Applied

[Standard changes list]

### Issues Requiring Attention

:warning: **Manual Review Needed:**

1. **Deprecation Warning** at `src/main/java/com/example/Service.java:45`
   - Using deprecated `WebSecurityConfigurerAdapter`
   - Recommendation: Migrate to component-based security config

2. **Test Failure** in `UserServiceTest.testAuthentication`
   - Cause: Security context changes in Spring Security 7
   - Action: Update test mocks

### Validation

| Check       | Status                    |
| ----------- | ------------------------- |
| Compilation | :white_check_mark: Passed |
| Unit Tests  | :warning: 2 failures      |

### Generated By

Spring Modernization Marketplace v1.0
```

## Dynamic PR Body Generation

Build PR body based on actual migration results:

```bash
# Collect migration stats
JACKSON_CHANGES=$(git diff --name-only | grep -c "\.java$" || echo "0")
BUILD_FILES=$(git diff --name-only | grep -E "(pom\.xml|build\.gradle)" | wc -l)

# Generate dynamic body
PR_BODY=$(cat <<EOF
## Spring Boot 4.x Migration

### Summary
- **Java files modified:** $JACKSON_CHANGES
- **Build files modified:** $BUILD_FILES
- **Branch:** $(git branch --show-current)
- **Commits:** $(git rev-list --count main..HEAD)

### Changes
$(git log main..HEAD --oneline | sed 's/^/- /')

### Generated By
Spring Modernization Marketplace v1.0
EOF
)

gh pr create --title "chore: Migrate to Spring Boot 4.x" --body "$PR_BODY"
```

## Batch PR Creation

Create PRs for multiple repositories:

```bash
WORKSPACE="/tmp/migration-workspace"
REPOS=("repo1" "repo2" "repo3")

for repo in "${REPOS[@]}"; do
  cd "$WORKSPACE/$repo"

  # Verify branch exists and has commits
  if git log main..HEAD --oneline | head -1 > /dev/null 2>&1; then
    echo "Creating PR for $repo..."
    gh pr create \
      --title "chore: Migrate $repo to Spring Boot 4.x" \
      --body "$PR_BODY" \
      --label "spring-boot-4-migration"

    echo "PR created for $repo"
  else
    echo "No changes in $repo, skipping PR"
  fi
done
```

## Output Format

Report PR creation status:

```json
{
  "repo": "owner/repo",
  "pr": {
    "number": 123,
    "url": "https://github.com/owner/repo/pull/123",
    "title": "chore: Migrate to Spring Boot 4.x",
    "status": "created",
    "branch": "feature/spring-boot-4-migration",
    "base": "main"
  }
}
```

## Error Handling

### PR Already Exists

```bash
# Check for existing PR
EXISTING=$(gh pr list --head feature/spring-boot-4-migration --json number --jq '.[0].number')

if [ -n "$EXISTING" ]; then
  echo "PR #$EXISTING already exists, updating..."
  gh pr edit $EXISTING --body "$PR_BODY"
else
  gh pr create --title "..." --body "$PR_BODY"
fi
```

### Authentication Issues

```bash
# Verify GitHub CLI auth
gh auth status

# Re-authenticate if needed
gh auth login --web
```

## Label Pre-Creation Requirement

When using `--label` flag with `gh pr create`, the labels must already exist in the repository. Otherwise, PR creation fails with:

```text
could not add label: 'spring-boot-4' not found
```

### Solution: Use label-manager Skill

Before creating PRs with labels, invoke the `label-manager` skill to ensure labels exist:

```bash
# Check existing labels
gh label list --repo owner/repo --json name --jq ".[].name"

# Create missing labels
gh label create "spring-boot-4" --repo owner/repo --color "0E8A16" --description "Spring Boot 4.x migration"
gh label create "automated" --repo owner/repo --color "1D76DB" --description "Automated change via tooling"
gh label create "needs-review" --repo owner/repo --color "FBCA04" --description "Requires manual review"
```

### Integrated Workflow

```bash
REPO="owner/repo"
LABELS="spring-boot-4,automated"

# Step 1: Pre-create labels
IFS=',' read -ra LABEL_ARRAY <<< "$LABELS"
EXISTING=$(gh label list --repo "$REPO" --json name --jq ".[].name")

for label in "${LABEL_ARRAY[@]}"; do
  if ! echo "$EXISTING" | grep -q "^${label}$"; then
    gh label create "$label" --repo "$REPO" --color "0E8A16" 2>/dev/null || true
  fi
done

# Step 2: Create PR with labels
gh pr create \
  --repo "$REPO" \
  --title "chore: Migrate to Spring Boot 4.x" \
  --body "$PR_BODY" \
  --label "$LABELS"
```

**Note:** The `parallel-orchestrator` and `migrate-github` command handle label pre-creation automatically in Phase 5.5.

## Critical Rules

1. **Always verify branch is pushed** before creating PR
2. **Use descriptive titles** following conventional commits
3. **Include validation results** in PR body
4. **Pre-create labels** before using `--label` flag (use `label-manager` skill)
5. **Never create PRs with failing builds** unless explicitly noted
6. **Link related issues** when applicable
